(()=>{function J(e,t){return t?require(e):e.slice?J[o(e)]:function(t,n){e(t={exports:{}}),J[o(n)]=t.exports};function o(t){return t.split("/").slice(-1).toString().replace(".js","")}}var a;"undefined"!=typeof module&&(a=module),J(function(t){String.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t--;)e+=n.charAt(Math.floor(Math.random()*n.length));return e},String.match=function(t,n){var e,o;return"string"==typeof t&&(t===((n=(n="string"==typeof n?{"=":n}:n)||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},String.hash=function(t,n){if("string"==typeof t){if(n=n||0,t.length)for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}};var n,e,o,i,r,a,s,u,c,f,l,h,p,d,g,y,v=Object.prototype.hasOwnProperty;Object.plain=function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])},Object.empty=function(t,n){for(var e in t)if(v.call(t,e)&&(!n||-1==n.indexOf(e)))return!1;return!0},Object.keys=Object.keys||function(t){var n,e=[];for(n in t)v.call(t,n)&&e.push(n);return e},o=setTimeout,r=i=0,a=typeof setImmediate!=""+g&&setImmediate||(typeof MessageChannel==""+g?o:((n=new MessageChannel).port1.onmessage=function(t){""==t.data&&e()},function(t){e=t,n.port2.postMessage("")})),s=o.check=o.check||typeof performance!=""+g&&performance||{now:function(){return+new Date}},o.hold=o.hold||9,o.poll=o.poll||function(t){o.hold>=s.now()-i&&r++<3333?t():a(function(){i=s.now(),t()},r=0)},g=setTimeout,c=g.turn=g.turn||function(t){1==f.push(t)&&l(p)},f=c.s=[],l=g.poll,h=0,p=function(){(u=f[h++])&&u(),h!=f.length&&99!=h||(f=c.s=f.slice(h),h=0),f.length&&l(p)},g=setTimeout,y=g.turn,(g.each=g.each||function(r,a,s,u){u=u||9,function t(n,e,o){if(e=(n=(r||[]).splice(0,u)).length){for(var i=0;i<e&&d===(o=a(n[i]));i++);if(d===o)return void y(t)}s&&s(o)}()})()})(J,"./shim"),J(function(t){t.exports=function t(n,e,o){var i;return n?(i="function"==typeof e,n=(this.tag||(this.tag={}))[n]||i&&(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}}),i?(((i={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o}).back=n.last||n).to=i,n.last=i):((n=n.to)&&void 0!==e&&n.next(e),n)):{to:t}}})(J,"./onto"),J(function(t){t.exports=function(t){return null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t&&t!=1/0&&t!=-1/0&&t==t||!!t&&"string"==typeof t["#"]&&1===Object.keys(t).length&&t["#"]}})(J,"./valid"),J(function(t){function n(){var t=+new Date;return i=i<t?(e=0,t+n.drift):t+(e+=1)/o+n.drift}J("./shim");n.drift=0;var e=0,o=999,i=-1/0;n.is=function(t,n,e){t=n&&t&&t._&&t._[">"]||e;if(t)return"number"==typeof(t=t[n])?t:-1/0},n.ify=function(t,n,e,o,i){(t=t||{})._=t._||{},i&&(t._["#"]=i);i=t._[">"]||(t._[">"]={});return void 0!==n&&"_"!==n&&("number"==typeof e&&(i[n]=e),void 0!==o)&&(t[n]=o),t},t.exports=n})(J,"./state"),J(function(t){J("./shim"),t.exports=function(o){var i={s:{}},r=i.s,e=(o=o||{max:999,age:9e3},i.check=function(t){return!!r[t]&&e(t)},i.track=function(t){var n=r[t]||(r[t]={});return n.was=i.now=+new Date,i.to||(i.to=setTimeout(i.drop,o.age+9)),e.ed&&e.ed(t),n});return i.drop=function(e){i.to=null,i.now=+new Date;var t=Object.keys(r);console.STAT&&console.STAT(i.now,+new Date-i.now,"dup drop keys"),setTimeout.each(t,function(t){var n=r[t];n&&(e||o.age)>i.now-n.was||delete r[t]},0,99)},i}})(J,"./dup"),J(function(t){J("./onto"),t.exports=function(t,n){var e,o,i,r;if(this.on)return e=(this.opt||{}).lack||9e3,"function"!=typeof t?t&&(i=t["#"]||t,o=(this.tag||"")[i])?(n&&(o=this.on(i,n),clearTimeout(o.err),o.err=setTimeout(function(){o.off()},e)),!0):void 0:(i=n&&n["#"]||a(9),t&&((r=this.on(i,t,n)).err=r.err||setTimeout(function(){r.off(),r.next({err:"Error: No ACK yet.",lack:!0})},e)),i)};var a=String.random||function(){return Math.random().toString(36).slice(2)}})(J,"./ask"),J(function(t){function u(t){return t instanceof u?(this._={$:this}).$:this instanceof u?u.create(this._={$:this,opt:t}):new u(t)}function b(t){if(t)if(t.out===b)this.to.next(t);else{var n,e,o=this.as,o=o.at||o,i=o.$,r=o.dup,a=t.DBG,s=(s=t["#"])||(t["#"]=g(9));if(!r.check(s)){if(r.track(s),s=t._,t._="function"==typeof s?s:function(){},t.$&&t.$===(t.$._||"").$||(t.$=i),t["@"]&&!t.put&&(s=(r=t)["@"]||"",(n=s._)?(n.acks=(n.acks||0)+1,(n.err=r.err)&&(r["@"]=n["#"],_(n)),n.ok=r.ok||n.ok,n.stop||n.crack||(n.crack=n.match&&n.match.push(function(){f(n)})),f(n)):(e=(e=(e=(e=(e=r.$)&&e._)&&e.root)&&e.dup).check(s))&&(r["@"]=e["#"]||r["@"])),!o.ask(t["@"],t)){if(a&&(a.u=+new Date),t.put)return void c(t);t.get&&u.on.get(t,i)}a&&(a.uc=+new Date),this.to.next(t),a&&(a.ua=+new Date),t.nts||t.NTS||(t.out=b,o.on("out",t),a&&(a.ue=+new Date))}}}function c(a){var s,t,u,c,f,l,h,p,d,g,y,v,k,m;a&&(t=(s=a._||"").root=((s.$=a.$||"")._||"").root,a["@"]&&s.faith&&!s.miss?(a.out=b,t.on("out",a)):(s.latch=t.hatch,s.match=t.hatch=[],u=a.put,c=s.DBG=a.DBG,f=+new Date,n=n||f,u["#"]&&u["."]||(c&&(c.p=f),s["#"]=a["#"],s.msg=a,s.all=0,s.stun=1,l=Object.keys(u),console.STAT&&console.STAT(f,((c||s).pk=+new Date)-f,"put sort"),h=0,function t(n){if(p!=h){if(!(g=l[p=h]))return console.STAT&&console.STAT(f,((c||s).pd=+new Date)-f,"put"),void _(s);(y=u[g])?(m=y._)?g!==m["#"]?k=w+$(g)+"soul not same.":(v=m[">"])||(k=w+$(g)+"no state."):k=w+$(g)+"no meta.":k=w+$(g)+"no node.",d=Object.keys(y||{})}if(k)a.err=s.err=k,_(s);else{var e,o=0;for(n=n||0;n++<9&&(e=d[o++]);)if("_"!==e){var i=y[e],r=v[e];if(O===r){k=w+$(e)+"on"+$(g)+"no state.";break}if(!A(i)){k=w+$(e)+"on"+$(g)+"bad "+typeof i+$(i);break}!function t(n,e,o,i,r){var a,s=r._||"",u=s.root,c=u.graph;var f=c[o]||N,l=G(f,e,1),f=f[e];var h=s.DBG;!(a=console.STAT)||c[o]&&f||(a.has=(a.has||0)+1);c=x();if(c<i)return setTimeout(function(){t(n,e,o,i,r)},(a=i-c)>j?j:a),void(console.STAT&&console.STAT((h||s).Hf=+new Date,a,"future"));if(i<l)return;if(!s.faith&&i===l&&(n===f||T(n)<=T(f))&&!s.miss)return;s.stun++;var p=r["#"]+s.all++,c={toString:function(){return p},_:s};c.toJSON=c.toString;u.dup.track(c)["#"]=r["#"];h&&(h.ph=h.ph||+new Date);u.on("put",{"#":c,"@":r["@"],put:{"#":o,".":e,":":n,">":i},ok:r.ok,_:s})}(i,e,g,r,a),++S}(d=d.slice(o)).length?D(t):(++h,d=null,t(n))}}())))}function e(t){(e=(t._||"").DBG)&&(e.pa=+new Date,e.pm=e.pm||+new Date);var n,e=this.as,o=e.graph,i=t._,r=t.put,a=r["#"],s=r["."],u=r[":"],r=r[">"];(n=(n=(n=i.msg)&&n.put)&&n[a])&&y(n,s,r,u,a),o[a]=y(o[a],s,r,u,a),(n=(e.next||"")[a])&&n.on("in",t),_(i),this.to.next(t)}function _(t,n){var e,o;t.stop||!t.err&&0<--t.stun||(t.stop=1,(e=t.root)&&((o=t.match).end=1,o===e.hatch&&(!(o=t.latch)||o.end?delete e.hatch:e.hatch=o),t.hatch&&t.hatch(),setTimeout.each(t.match,function(t){t&&t()}),!(n=t.msg)||t.err||n.err||(n.out=b,t.root.on("out",n),i())))}function f(t){t&&t.root&&(t.stun||t.acks!==t.all||t.root.on("in",{"@":t["#"],err:t.err,ok:t.err?O:t.ok||{"":1}}))}var n,w,$,T,j,x,S,i;function s(t,a){var s=+new Date,n=t._||{},u=n.DBG=t.DBG,c=t["#"],f=g(9),l=Object.keys(a||"").sort(),h=((a||"")._||"")["#"],p=(l.length,t.$._.root),d=a===p.graph[h];console.STAT&&console.STAT(s,((u||n).gk=+new Date)-s,"got keys"),a&&function t(){s=+new Date;for(var n,e,o,i=0,r={};i<9&&(n=l[i++]);)y(r,n,G(a,n),a[n],h);l=l.slice(i),(e={})[h]=r,r=e,d&&((o=function(){}).ram=o.faith=!0),e=l.length,console.STAT&&console.STAT(s,-(s-(s=+new Date)),"got copied some"),u&&(u.ga=+new Date),p.on("in",{"@":c,"#":f,put:r,"%":e?f=g(9):O,$:p.$,_:o,DBG:u,FOO:1}),console.STAT&&console.STAT(s,+new Date-s,"got in"),e&&setTimeout.turn(t)}(),a||p.on("in",{"@":t["#"]})}u.is=function(t){return t instanceof u||t&&t._&&t===t._.$||!1},u.version=.202,(u.chain=u.prototype).toJSON=function(){},J("./shim"),u.valid=J("./valid"),u.state=J("./state"),u.on=J("./onto"),u.dup=J("./dup"),u.ask=J("./ask"),u.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||u.on,t.ask=t.ask||u.ask,t.dup=t.dup||u.dup();var n=t.$.opt(t.opt);return t.once||(t.on("in",b,t),t.on("out",b,t),t.on("put",e,t),u.on("create",t),t.on("create",t)),t.once=1,n},u.on.put=c,w="Error: Invalid graph!",$=function(t){return" '"+(""+t).slice(0,9)+"...' "},T=JSON.stringify,j=2147483647,x=u.state,S=0,i=function(){999<S&&1<S/-(n-(n=+new Date))&&(u.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),i=function(){S=0})},u.on.get=function(t,n){var n=n._,e=t.get,o=e["#"],i=n.graph[o],e=e["."],r=(n.next||(n.next={}))[o],a=(t._||{}).DBG=t.DBG;if(a&&(a.g=+new Date),!i)return n.on("get",t);if(e){if(("string"!=typeof e||O===i[e])&&!((r||"").next||"")[e])return void n.on("get",t);i=y({},e,G(i,e),i[e],o)}i&&s(t,i),n.on("get",t)},u.on.get.ack=s,u.chain.opt=function(e){e=e||{};var o=this._,t=e.peers||e;return Object.plain(e)||(e={}),Object.plain(o.opt)||(o.opt=e),"string"==typeof t&&(t=[t]),Object.plain(o.opt.peers)||(o.opt.peers={}),t instanceof Array&&(e.peers={},t.forEach(function(t){var n={};n.id=n.url=t,e.peers[t]=o.opt.peers[t]=o.opt.peers[t]||n})),r(e,function t(n){var e=this[n];this&&this.hasOwnProperty(n)||"string"==typeof e||Object.empty(e)?this[n]=e:(!e||e.constructor===Object||e instanceof Array)&&r(e,t)}),o.opt.from=e,u.on("opt",o),o.opt.uuid=o.opt.uuid||function(t){return u.state().toString(36).replace(".","")+String.random(t||12)},this};var O,o,r=function(t,n){Object.keys(t).forEach(n,t)},g=String.random,D=setTimeout.turn,A=u.valid,G=u.state.is,y=u.state.ify,N={};(u.log=function(){return u.log.off||o.log.apply(o,arguments),[].slice.call(arguments).join(" ")}).once=function(t,n,e){return(e=u.log.once)[t]=e[t]||0,e[t]++||u.log(n)},"undefined"!=typeof window&&((window.GUN=window.Gun=u).window=window);try{void 0!==a&&(a.exports=u)}catch(t){}((t.exports=u).window||{}).console=(u.window||{}).console||{log:function(){}},(o=console).only=function(t,n){return o.only.i&&t===o.only.i&&o.only.i++&&(o.log.apply(o,arguments)||n)},u.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(J,"./root"),J(function(t){J("./root").chain.back=function(t,n){if(-1===(t=t||1)||1/0===t)return this._.root.$;if(1===t)return(this._.back||this._).$;var e=this._;if((t="string"==typeof t?t.split("."):t)instanceof Array){for(var o=0,i=t.length,r=e;o<i;o++)r=(r||s)[t[o]];return void 0!==r?n?this:r:(r=e.back)?r.$.back(t,n):void 0}if("function"!=typeof t)return"number"==typeof t?(e.back||e).$.back(t-1):this;for(var a,r={back:e};(r=r.back)&&void 0===(a=t(r,n)););return a};var s={}})(J,"./back"),J(function(t){var r=J("./root");function l(t,n){if(n=n||this.as||t.$._,(!t.$$||this===r.on)&&t.put&&!n.soul){var t=t.put||"",e=t["="]||t[":"],o=n.root,t=o.$.get(t["#"]).get(t["."])._;if("string"!=typeof(e=g(e)))this===r.on&&((t.echo||(t.echo={}))[n.id]=n);else if(!(t.echo||(t.echo={}))[n.id]||(o.pass||"")[n.id]){if(i=o.pass){if(i[e+n.id])return;i[e+n.id]=1}((t.echo||(t.echo={}))[n.id]=n).has&&(n.link=e);var i,o=o.$.get(t.link=e)._;(o.echo||(o.echo={}))[t.id]=t,((i=n.ask||"")[""]||n.lex)&&o.on("out",{get:{"#":e}}),setTimeout.each(Object.keys(i),function(t,n){t&&(n=i[t])&&n.on("out",{get:{"#":e,".":t}})},0,99)}}}function h(t,e){var o,n,i=t.put||"",i=p!==i["="]?i["="]:i[":"],r=e.root;if(p===i)return(!e.soul||p===e.put)&&(n=(t.$$||t.$||"")._||"",!t["@"]||p===n.put&&p===e.put)?((o=e.link||t.linked)&&delete(r.$.get(o)._.echo||"")[e.id],e.has&&(e.link=null),e.put=p,void setTimeout.each(Object.keys(e.next||""),function(t,n){(n=e.next[t])&&(o&&delete(r.$.get(o).get(t)._.echo||"")[n.id],n.on("in",{get:t,put:p,$:n.$}))},0,99)):void 0;e.soul||!t.$$&&(o=g(i),n=t.$._||"",o!==n.link&&(!e.has||n.link)||(r.pass||"")[e.id]&&"string"!=typeof o)&&(delete(n.echo||"")[e.id],h({get:e.get,put:p,$:t.$,linked:t.linked=t.linked||n.link},e))}function a(t,n){var e=this.as,o=e.$._,e=(o.root,e.get||""),i=(t.put||"")[e["#"]]||"";if(!t.put||"string"==typeof e["."]&&p===i[e["."]])return p===o.put&&(o.soul||o.has)?(o.ack=(o.ack||0)+1,void o.on("in",{get:o.get,put:o.put=p,$:o.$,"@":t["@"]})):void 0;(t._||{}).miss=1,r.on.put(t)}r.chain.chain=function(t){var n=this,e=n._,t=new(t||n).constructor(n),o=t._;return o.root=e=e.root,o.id=++e.once,o.back=n._,o.on=r.on,o.on("in",r.on.in,o),o.on("out",r.on.out,o),t},r.on.out=function(t){var n,e,o=this.as,i=o.back,r=o.root;if(t.$||(t.$=o.$),this.to.next(t),!o.err){if(n=t.get){if(r.pass&&(r.pass[o.id]=o),o.lex&&Object.keys(o.lex).forEach(function(t){e[t]=o.lex[t]},e=t.get=t.get||{}),n["#"]||o.soul){if(n["#"]=n["#"]||o.soul,t["#"]||(t["#"]=s(9)),i=r.$.get(n["#"])._,n=n["."]){if(u(i.put,n)&&(e=i.ask&&i.ask[n],(i.ask||(i.ask={}))[n]=i.$.get(n)._,i.on("in",{get:n,put:{"#":i.soul,".":n,":":i.put[n],">":y(r.graph[i.soul],n)}}),e))return}else{if(e=i.ask&&i.ask[""],(i.ask||(i.ask={}))[""]=i,p!==i.put&&(i.on("in",i),e))return;t.$=i.$}return r.ask(a,t),r.on("in",t)}if(n["."])return o.get?(t={get:{".":o.get},$:o.$},(i.ask||(i.ask={}))[o.get]=t.$._):t={get:o.lex?t.get:{},$:o.$},i.on("out",t);if(((o.ask||(o.ask={}))[""]=o).get)n["."]=o.get,(i.ask||(i.ask={}))[o.get]=t.$._}return i.on("out",t)}o.on("in",{put:o.put=p,$:o.$})},r.on.in=function(n,e){var o,t,i=(e=e||this.as).root,r=(n.$||(n.$=e.$)||"")._||d,a=n.put||"",s=a["#"],u=a["."],c=p!==a["="]?a["="]:a[":"],f=a[">"]||-1/0;if(p!==n.put&&(p===a["#"]||p===a["."]||p===a[":"]&&p===a["="]||p===a[">"]))return g(a)?void e.on("in",{$:r.back.$,put:{"#":s=r.back.soul,".":u=r.has||r.get,"=":a,">":y(r.back.put,u)},via:n}):(s=((a||"")._||"")["#"])?(o=e.root.$.get(s),setTimeout.each(Object.keys(a).sort(),function(t){"_"!=t&&p!==(f=y(a,t))&&e.on("in",{$:o,put:{"#":s,".":t,"=":a[t],">":f},VIA:n})})):void console.log("chain not yet supported for",a,"...",n,e);(n.seen||"")[e.id]||(((n.seen||(n.seen=function(){}))[e.id]=e)!==r&&(Object.keys(n).forEach(function(t){a[t]=n[t]},a={}),a.get=e.get||a.get,e.soul||e.has?r.soul&&(a.$=e.$,a.$$=a.$$||r.$):a.$$$=a.$$$||e.$,n=a),h(n,e),(e.soul||n.$$)&&f>=y(i.graph[s],u)&&((a=i.$.get(s)._).put=v(a.put,u,f,c,s)),!r.soul&&f>=y(i.graph[s],u)&&(t=(i.$.get(s)._.next||"")[u])&&(t.put=c,"string"==typeof(a=g(c)))&&(t.put=i.$.get(a)._.put||c),this.to&&this.to.next(n),e.any&&setTimeout.each(Object.keys(e.any),function(t){(t=e.any[t])&&t(n)},0,99),e.echo&&setTimeout.each(Object.keys(e.echo),function(t){(t=e.echo[t])&&t.on("in",n)},0,99),((n.$$||"")._||r).soul&&(t=(t=e.next)&&t[u])&&(a={},Object.keys(n).forEach(function(t){a[t]=n[t]}),a.$=(n.$$||n.$).get(a.get=u),delete a.$$,delete a.$$$,t.on("in",a)),l(n,e))},r.on.link=l,r.on.unlink=h;var p,d={},s=String.random,g=r.valid,u=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},n=r.state,y=n.is,v=n.ify})(J,"./chain"),J(function(t){var v=J("./root");function k(t){var n=this.at||this.on;return!t||n.soul||n.has?this.off():(t=(t=(t=t.$||t)._||t).id)?(n.map,!!(n=this.seen||(this.seen={}))[t]||void(n[t]=!0)):void 0}v.chain.get=function(t,n,e){var o,i,r,a,s,u,c,f,l,h,p;if("string"==typeof t){if(0==t.length)return(g=this.chain())._.err={err:v.log("0 length key!",t)},n&&n.call(g,g._.err),g;var d,g;g=(g=(g=((d=this._).next||b)[t])||t&&((t,n)=>{var e=n._,o=e.next,i=n.chain()._;return(o=o||(e.next={}))[i.get=t]=i,n===e.root.$?i.soul=t:(e.soul||e.has)&&(i.has=t),i})(t,this))&&g.$}else if("function"==typeof t){return!0===n?(r=t,a=e,u=(i=this)._,c=0,(s=u.soul||u.link)?r(s,a,u):u.jam?u.jam.push([r,a]):(u.jam=[[r,a]],i.get(function(t,n){if(!(m===t.put&&!u.root.opt.super&&(s=Object.keys(u.root.opt.peers).length)&&++c<=s)){n.rid(t);var e=(e=t.$)&&e._||{},o=0;for(s=u.jam,delete u.jam;r=s[o++];){var i=r[0],r=r[1];i&&i(e.link||e.soul||v.valid(t.put)||((t.put||{})._||{})["#"],r,t,n)}}},{out:{get:{".":!0}}})),this):(d=(g=this)._,f=n||{},l=d.root,f.at=d,f.ok=t,p={},(((y.at=d).any||(d.any={}))[h=String.random(7)]=y).off=function(){y.stun=1,d.any&&delete d.any[h]},y.rid=k,y.id=f.run||++l.once,o=l.pass,(l.pass={})[h]=1,f.out=f.out||{get:{}},d.on("out",f.out),l.pass=o,g);function y(n,t,e){if(!y.stun&&(!(o=l.pass)||o[h])){var o,i=n.$._,r=(n.$$||"")._,a=(r||i).put,s=!i.has&&!i.soul,u={};if(!s&&m!==a||(a=m===((o=n.put)||"")["="]?m===(o||"")[":"]?o:o[":"]:o["="]),"string"==typeof(o=v.valid(a))&&(a=m===(o=l.$.get(o)._.put)?f.not?m:a:o),!f.not||m!==a){if(m===f.stun){if((o=l.stun)&&o.on&&(d.$.back(function(t){if(o.on(""+t.id,u={}),(u.run||0)<y.id)return u}),u.run||o.on(""+i.id,u={}),!u.run&&r&&o.on(""+r.id,u={}),y.id>u.run)&&(u.stun&&!u.stun.end||(u.stun=o.on("stun"),u.stun=u.stun&&u.stun.last),u.stun)&&!u.stun.end)return void((u.stun.add||(u.stun.add={}))[h]=function(){y(n,t,1)});if(m===a&&(e=0),(o=l.hatch)&&!o.end&&m===f.hatch&&!e)return p[i.$._.id]?void 0:(p[i.$._.id]=1,void o.push(function(){y(n,t,1)}));p={}}if(l.pass){if(l.pass[h+i.id])return;l.pass[h+i.id]=1}f.on?f.ok.call(i.$,a,i.get,n,t||y):f.v2020?f.ok(n,t||y):(Object.keys(n).forEach(function(t){o[t]=n[t]},o={}),(n=o).put=a,f.ok.call(f.as,n,t||y))}}}}else{if("number"==typeof t)return this.get(""+t,n,e);if("string"==typeof(o=_(t)))return this.get(o,n,e);(o=this.get.next)&&(g=o(this,t))}return g?n&&"function"==typeof n&&g.get(n,e):((g=this.chain())._.err={err:v.log("Invalid get request!",t)},n&&n.call(g,g._.err)),g};var m,b={},_=v.valid})(J,"./get"),J(function(t){var v=J("./root");function k(n,t){var e,o,i;t&&(t=(t._||"").id||t,e=n.root.stun||(n.root.stun={on:v.on}),o={},n.stun||(n.stun=e.on("stun",function(){})),(i=e.on(""+t))&&i.the.last.next(o),o.run>=n.run||e.on(""+t,function(t){n.stun.end?(this.off(),this.to.next(t)):(t.run=t.run||n.run,t.stun=t.stun||n.stun)}))}function m(n){var e,t,o,i,r;n.err?m.end(n.stun,n.root):n.todo.length||n.end||!Object.empty(n.wait)||(n.end=1,t=n.$.back(-1)._,e=t.root,t=t.ask(function(t){e.on("ack",t),t.err&&!t.lack&&v.log(t),++o>(n.acks||0)&&this.off(),n.ack&&n.ack(t,this)},n.opt),o=0,i=n.stun,(r=function(){i&&(m.end(i,e),setTimeout.each(Object.keys(i=i.add||""),function(t){(t=i[t])&&t()}))}).hatch=r,n.ack&&!n.ok&&(n.ok=n.acks||9),n.via._.on("out",{put:n.out=n.graph,ok:n.ok&&{"@":n.ok+1},opt:n.opt,"#":t,_:r}))}v.chain.put=function(t,n,g){var e,o,i=this,r=i._,a=r.root,y=((g=g||{}).root=r.root,g.run||(g.run=a.once),k(g,r.id),g.ack=g.ack||n,g.via=g.via||i,g.data=g.data||t,g.soul||(g.soul=r.soul||"string"==typeof n&&n),g.state=g.state||v.state());return"function"==typeof t?t(function(t){g.data=t,i.put(void 0,void 0,g)}):g.soul?(g.$=a.$.get(g.soul),g.todo=[{it:g.data,ref:g.$}],g.turn=g.turn||s,g.ran=g.ran||m,function t(){var n,e,i,r,a,o,s,u=g.todo,c=u.pop(),f=c.it;c.ref&&c.ref._.id;if(k(g,c.ref),(r=c.todo)&&(f=f[e=r.pop()],r.length)&&u.push(c),e&&(u.path||(u.path=[])).push(e),!(n=b(f))&&!(a=v.is(f))){if(!Object.plain(f))return void m.err(g,"Invalid data: "+((o=f)&&(s=o.constructor)&&s.name||typeof o)+" at "+(g.via.back(function(t){t.get&&r.push(t.get)},r=[])||r.join("."))+"."+(u.path||[]).join("."));for(var l=g.seen||(g.seen=[]),h=l.length;h--;)if(f===(r=l[h]).it){n=f=r.link;break}}if(e&&n)c.node=_(c.node,e,y,f);else{if(!g.seen)return void m.err(g,"Data at root of graph must be a node (an object).");g.seen.push(i={it:f,link:{},todo:a?[]:Object.keys(f).sort().reverse(),path:(u.path||[]).slice(),up:c}),c.node=_(c.node,e,y,i.link),!a&&i.todo.length&&u.push(i);var p=g.seen.length;function d(t,n){var e=i.link["#"],o=(n&&(n.off(),n.rid(t)),e||t.soul||(r=(t.$$||t.$)._||"").soul||r.link||((r=r.put||"")._||"")["#"]||r["#"]||((r=t.put||"")&&t.$$?r:r["="]||r[":"]||"")["#"]);e||k(g,t.$),o||c.link["#"]?(o||(o=[],(t.$$||t.$).back(function(t){if(r=t.soul||t.link)return o.push(r);o.push(t.get)}),o=o.reverse().join("/")),i.link["#"]=o,a||(((g.graph||(g.graph={}))[o]=i.node||(i.node={_:{}}))._["#"]=o),delete g.wait[p],i.wait&&setTimeout.each(i.wait,function(t){t&&t()}),g.ran(g)):(c.wait||(c.wait=[])).push(function(){d(t,n)})}(g.wait||(g.wait={}))[p]="",r=(i.ref=a?f:e?c.ref.get(e):c.ref)._,(r=f&&(f._||"")["#"]||r.soul||r.link)?d({soul:r}):i.ref.get(d,{run:g.run,v2020:1,out:{get:{".":" "}}})}if(!u.length)return g.ran(g);g.turn(t)}()):(r=(e=g).via._,e.via=e.via.back(function(t){if(t.soul||!t.get)return t.$;o=e.data,(e.data={})[t.get]=o}),e.via&&e.via._.soul||(e.via=r.root.$.get(((e.data||"")._||"")["#"]||r.$.back("opt.uuid")())),e.via.put(e.data,e.ack,e)),i},m.end=function(t,n){t.end=e,t.the.to===t&&t===t.the.last&&delete n.stun,t.off()},m.err=function(t,n){(t.ack||e).call(t,t.out={err:t.err=v.log(n)}),t.ran(t)};var e=function(){},s=setTimeout.turn,b=v.valid,_=v.state.ify})(J,"./put"),J(function(t){var n=J("./root");J("./chain"),J("./back"),J("./put"),J("./get"),t.exports=n})(J,"./index"),J(function(t){var g=J("./index");g.chain.on=function(t,n,e,o){var i=this._;i.root;return"string"==typeof t?n?(o=i.on(t,n,e||i,o),e&&e.$&&(e.subs||(e.subs=[])).push(o),this):i.on(t):((e=!0===(e=n)?{change:!0}:e||{}).not=1,e.on=1,this.get(t,e),this)},g.chain.once=function(c,f){var t,e,l,h,p,d;return f=f||{},c?(l=this._,h=l.root,p=String.random(7),this.get(function(n,e,o,i){var r=this,a=r._,s=a.one||(a.one={});function u(t){a.has||a.soul||(a={put:n,get:e}),void 0===(d=a.put)&&(d=((o.$$||"")._||"").put),"string"!=typeof g.valid(d)||void 0!==(d=h.$.get(d)._.put)||t?i.stun||""!==s[p]&&(s[p]="",(l.soul||l.has)&&i.off(),c.call(r,d,a.get),clearTimeout(s[p])):s[p]=setTimeout(function(){u(1)},f.wait||99)}i.stun||""!==s[p]&&(!0===(d=g.valid(n))?u():"string"!=typeof d&&(clearTimeout((l.one||"")[p]),clearTimeout(s[p]),s[p]=setTimeout(u,f.wait||99)))},{on:1}),this):(t=this,g.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(e=t.chain())._.nix=t.once(function(t,n){e._.on("in",this._)}),e._.lex=t._.lex,e)},g.chain.off=function(){var e,t=this._,o=t.back;if(o)return t.ack=0,(e=o.next)&&e[t.get]&&delete e[t.get],(e=o.any)&&(delete o.any,o.any={}),(e=o.ask)&&delete e[t.get],(e=o.put)&&delete e[t.get],(e=t.soul)&&delete o.root.graph[e],(e=t.map)&&Object.keys(e).forEach(function(t,n){(n=e[t]).link&&o.root.$.get(n.link).off()}),(e=t.next)&&Object.keys(e).forEach(function(t,n){e[t].$.off()}),t.on("off",{}),this}})(J,"./on"),J(function(t){var s=J("./index"),o=s.chain.get.next;function u(t){this.to.next(t);var n,e=this.as;!t.$._.soul&&!t.$$||(n=e.lex)&&!String.match(t.get||(t.put||"")["."],n["."]||n["#"]||n)||s.on.link(t,e)}s.chain.get.next=function(t,n){var e;return Object.plain(n)?(e=((e=n["#"])||"")["="]||e)?t.get(e):((e=t.chain()._).lex=n,t.on("in",function(t){String.match(t.get||(t.put||"")["."],n["."]||n["#"]||n)&&e.on("in",t),this.to.next(t)}),e.$):(o||c)(t,n)},s.chain.map=function(r,t,n){var e,a,o=this,i=o._;return Object.plain(r)&&(e=r["."]?r:{".":r},r=void 0),r?(s.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),a=o.chain(),o.map().on(function(t,n,e,o){var i,o=(r||c).call(this,t,n,e,o);if(void 0!==o)return t===o?a._.on("in",e):s.is(o)?a._.on("in",o._):(i={},Object.keys(e.put).forEach(function(t){i[t]=e.put[t]},i),i["="]=o,void a._.on("in",{get:n,put:i}))})):(a=i.each)||((i.each=a=o.chain())._.lex=e||a._.lex||i.lex,a._.nix=o.back("nix"),o.on("in",u,a._)),a};var c=function(){}})(J,"./map"),J(function(t){var s=J("./index");s.chain.set=function(t,i,n){var e,r,a=this,o=a.back(-1);return i=i||function(){},(n=n||{}).item=n.item||t,(e=((t||"")._||"")["#"])&&((t={})["#"]=e),"string"==typeof(r=s.valid(t))?a.get(e=r).put(t,i,n):s.is(t)?(a.put(function(o){t.get(function(t,n,e){if(!t)return i.call(a,{err:s.log('Only a node can be linked! Not "'+e.put+'"!')});(r={})[t]={"#":t},o(r)},!0)}),t):(Object.plain(t)&&(t=o.get(e=a.back("opt.uuid")()).put(t)),a.get(e||o.back("opt.uuid")(7)).put(t,i,n))}})(J,"./set"),J(function(t){J("./shim");function n(){}var r=JSON.parseAsync||function(t,n,e){var o=+new Date;try{n(void 0,JSON.parse(t,e),w.sucks(+new Date-o))}catch(t){n(t)}},w=JSON.stringifyAsync||function(t,n,e,o){var i=+new Date;try{n(void 0,JSON.stringify(t,e,o),w.sucks(+new Date-i))}catch(t){n(t)}};w.sucks=function(t){99<t&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),w.sucks=n)};var $;try{t.exports=function(u){var p,d=function(){},g=u.opt||{},y=(g.log=g.log||console.log,g.gap=g.gap||g.wait||0,g.max=g.max||.3*(g.memory?999*g.memory*999:3e8),g.pack=g.pack||.01*g.max*.01,g.puff=g.puff||9,setTimeout.turn||setTimeout),v=u.dup,h=v.check,k=v.track,i=(new Date,d.hear=function(t,a){if(t){if(g.max<=t.length)return d.say({dam:"!",err:"Message too big!"},a);d===this&&(i.d+=t.length||0,++i.c);var n,e=a.SH=+new Date,o=t[0];if("["===o)r(t,function(t,i){if(t||!i)return d.say({dam:"!",err:"DAM JSON parse error."},a);console.STAT&&console.STAT(+new Date,i.length,"# on hear batch");var r=g.puff;!function t(){for(var n,e=+new Date,o=0;o<r&&(n=i[o++]);)d.hear(n,a);i=i.slice(o),console.STAT&&console.STAT(e,+new Date-e,"hear loop"),b(a),i.length&&y(t,0)}()}),t="";else if("{"===o||(t["#"]||Object.plain(t))&&(n=t)){if(n)return i.one(n,a,e);r(t,function(t,n){if(t||!n)return d.say({dam:"!",err:"DAM JSON parse error."},a);i.one(n,a,e)})}}}),m=(i.one=function(n,e,t){var o,i,r,a,s;n.DBG&&(n.DBG=a={DBG:n.DBG}),a&&(a.h=t),a&&(a.hp=+new Date),o=(o=n["#"])||(n["#"]=String.random(9)),(i=h(o))||(s=n["##"])&&(i=n["@"]||n.get&&o)&&v.check(r=i+s)||((n._=function(){}).via=d.leap=e,(i=n["><"])&&"string"==typeof i&&i.slice(0,99).split(",").forEach(function(t){this[t]=1},n._.yo={}),(i=n.dam)?((i=d.hear[i])&&i(n,e,u),k(o)):((i=n.ok)&&(n._.near=i["/"]),t=+new Date,a&&(a.is=t),e.SI=o,k.ed=function(t){o===t&&(k.ed=0,t=v.s[o])&&(t.via=e,n.get)&&(t.it=n)},u.on("in",d.last=n),a&&(a.hd=+new Date),console.STAT&&console.STAT(t,+new Date-t,n.get?"msg get":n.put?"msg put":"msg"),k(o),r&&k(r),d.leap=d.last=null))},i.c=i.d=0);function t(t,n){var e;return n instanceof Object?(Object.keys(n).sort().forEach(o,{to:e={},on:n}),e):n}function o(t){this.to[t]=this.on[t]}function b(t){var n=t.batch,e="string"==typeof n;if(e&&(n+="]"),t.batch=t.tail=null,n&&(e?!(n.length<3):n.length)){if(!e)try{n=1===n.length?n[0]:JSON.stringify(n)}catch(t){return g.log("DAM JSON stringify error",t)}n&&_(n,t)}}function _(n,e){try{var t=e.wire;e.say?e.say(n):t.send&&t.send(n),d.say.d+=n.length||0,++d.say.c}catch(t){(e.queue=e.queue||[]).push(n)}}return d.hash=function(o,i){var r,a,s,u=+new Date;w(o.put,function t(n,e){e=(a=a||(s=e||"")).slice(0,32768);r=String.hash(e,r),(a=a.slice(32768))?y(t,0):(console.STAT&&console.STAT(u,+new Date-u,"say json+hash"),o._.$put=s,o["##"]=r,d.say(o,i),delete o._.$put)},t)},d.say=function(r,a){var t;if((t=(t=this)&&t.to)&&t.next&&t.next(r),!r)return!1;var n,e,s,u,c,f=r["@"],l=r._||(r._=function(){}),o=r.DBG,i=+new Date;if(l.y=l.y||i,a||o&&(o.y=i),n=(n=r["#"])||(r["#"]=String.random(9)),p||k(n),(e=r["##"])||$===r.put||l.via||!f){if(!(a=!a&&f?(t=v.s[f])&&(t.via||(t=(t=t.it)&&t._)&&t.via)||(t=d.last)&&f===t["#"]&&d.leap:a)&&f)return v.s[f]?void 0:(console.STAT&&console.STAT(+new Date,++m,"total no peer to ack to"),!1);if(f&&!r.put&&!e&&((v.s[f]||"").it||"")["##"])return!1;if(!a&&d.way)return d.way(r);if(o&&(o.yh=+new Date),s=l.raw){if(o&&(o.yr=+new Date),!a||!a.id)return!!Object.plain(a||g.peers)&&(i=+new Date,g.puff,u=g.peers,c=Object.keys(a||g.peers||{}),console.STAT&&console.STAT(i,+new Date-i,"peer keys"),void function t(){for(var n,e=+new Date,o=(p=1,l.raw),i=(l.raw=s,0);i<9&&(n=(c||"")[i++]);)(n=u[n]||(a||"")[n])&&d.say(r,n);l.raw=o,p=0,c=c.slice(i),console.STAT&&console.STAT(e,+new Date-e,"say loop"),c.length&&(y(t,0),f)&&k(f)}());if(!a.wire&&d.wire&&d.wire(a),n!==a.last){if(a.last=n,a===l.via)return!1;if((t=l.yo)&&(t[a.url]||t[a.pid]||t[a.id]))return!1;if(console.STAT&&console.STAT(i,((o||l).yp=+new Date)-(l.y||i),"say prep"),!p&&f&&k(f),a.batch){if(a.tail=(t=a.tail||0)+s.length,a.tail<=g.pack)return void(a.batch+=(t?",":"")+s);b(a)}a.batch="[";var h=+new Date;setTimeout(function(){console.STAT&&console.STAT(h,+new Date-h,"0ms TO"),b(a)},g.gap),_(s,a),console.STAT&&f===a.SI&&console.STAT(i,+new Date-a.SH,"say ack")}}else d.raw(r,a)}else d.hash(r,a)},d.say.c=d.say.d=0,d.raw=function(e,o){if(!e)return"";var i,r=e._||{};if(s=r.raw)return s;if("string"==typeof e)return e;var t=e["##"],n=e["@"];if(t&&n){if(!r.via&&h(n+t))return!1;if(s=(v.s[n]||"").it){if(t===s["##"])return!1;s["##"]||(s["##"]=t)}}if(!e.dam&&!e["@"]){var a,s,u=0,c=[];for(a in s=g.peers){var f=s[a];if(c.push(f.url||f.pid||f.id),6<++u)break}1<u&&(e["><"]=c.join())}function l(t,n){t||(r.raw=n,d.say(e,o))}e.put&&(s=e.ok)&&(e.ok={"@":(s["@"]||1)-1,"/":s["/"]==e._.near?d.near:s["/"]}),(i=r.$put)?(s={},Object.keys(e).forEach(function(t){s[t]=e[t]}),s.put=":])([:",w(s,function(t,n){t||(t=+new Date,s=n.indexOf('"put":":])([:"'),l($,n=n.slice(0,s+6)+i+n.slice(s+14)),console.STAT&&console.STAT(t,+new Date-t,"say slice"))})):w(e,l)},d.near=0,d.hi=function(n){var t;n.wire?(n.id?g.peers[n.url||n.id]=n:(t=n.id=n.id||n.url||String.random(9),d.say({dam:"?",pid:u.opt.pid},g.peers[t]=n),delete v.s[n.last]),n.met||(d.near++,n.met=+new Date,u.on("hi",n)),t=n.queue,n.queue=[],setTimeout.each(t||[],function(t){_(t,n)},0,9)):d.wire(n.length?{url:n,id:n}:n)},d.bye=function(t){t.met&&--d.near,delete t.met,u.on("bye",t);var n=+new Date;n-=t.met||n,d.bye.time=((d.bye.time||n)+n)/2},d.hear["!"]=function(t,n){g.log("Error:",t.err)},d.hear["?"]=function(t,n){t.pid&&(n.pid||(n.pid=t.pid),t["@"])||(d.say({dam:"?",pid:g.pid,"@":t["#"]},n),delete v.s[n.last])},d.hear.mob=function(t,n){t.peers&&(t=(t=Object.keys(t.peers))[Math.random()*t.length>>0])&&(d.bye(n),d.hi(t))},u.on("create",function(t){t.opt.pid=t.opt.pid||String.random(9),this.to.next(t),t.on("out",d.say)}),u.on("bye",function(t,n){t=g.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(n=t.wire)&&n.close&&n.close(),delete g.peers[t.id],t.wire=null}),u.on("bye",function(t,n){this.to.next(t),(n=console.STAT)&&(n.peers=d.near),(n=t.url)&&(n,setTimeout(function(){n,0},g.lack||9e3))}),u.on("hi",function(e,t){this.to.next(e),(t=console.STAT)&&(t.peers=d.near),g.super||(9999<(t=Object.keys(u.next||"")).length&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(t,function(n){var t=u.next[n];g.super||(t.ask||"")[""]?d.say({get:{"#":n}},e):setTimeout.each(Object.keys(t.ask||""),function(t){t&&d.say({"##":String.hash((u.graph[n]||"")[t]),get:{"#":n,".":t}},e)})}))}),d}}catch(t){}})(J,"./mesh"),J(function(t){var s=J("./index");s.Mesh=J("./mesh"),s.on("opt",function(t){var o,n,e,i;function r(n){try{var t,e;return n&&n.url?(t=n.url.replace(/^http/,"ws"),(e=n.wire=new o.WebSocket(t)).onclose=function(){a(n),o.mesh.bye(n)},e.onerror=function(t){a(n)},e.onopen=function(){o.mesh.hi(n)},e.onmessage=function(t){t&&o.mesh.hear(t.data||t,n)},e):e&&e(n)}catch(t){o.mesh.bye(n)}}function a(n){clearTimeout(n.defer),!o.peers[n.url]||i&&n.retry<=0||(n.retry=(n.retry||o.retry+1||60)-(-n.tried+(n.tried=+new Date)<4*e?1:0),n.defer=setTimeout(function t(){if(i&&i.hidden)return setTimeout(t,e);r(n)},e))}this.to.next(t),t.once||!1!==(o=t.opt).WebSocket&&(n=s.window||{},n=o.WebSocket||n.WebSocket||n.webkitWebSocket||n.mozWebSocket)&&(o.WebSocket=n,(n=o.mesh=o.mesh||s.Mesh(t)).wire||o.wire,n.wire=o.wire=r,setTimeout(function(){o.super||t.on("out",{dam:"hi"})},1),e=1998,i=""+void 0!=typeof document&&document)})})(J,"./websocket"),J(function(t){if("undefined"!=typeof Gun){var i;try{i=(Gun.window||function(){}).localStorage}catch(t){}i||(Gun.log("Warning: No localStorage exists to persist data to!"),i={setItem:function(t,n){this[t]=n},removeItem:function(t){delete this[t]},getItem:function(t){return this[t]}});JSON.parseAsync;var h=JSON.stringifyAsync||function(t,n,e,o){try{n(void 0,JSON.stringify(t,e,o))}catch(t){n(t)}};Gun.on("create",function n(r){this.to.next(r);var a,s,u,c,o=r.opt,f=[];if(!1!==o.localStorage){o.prefix=o.file||"gun/";try{a=n[o.prefix]=n[o.prefix]||JSON.parse(u=i.getItem(o.prefix))||{}}catch(t){a=n[o.prefix]={}}u=(u||"").length,r.on("get",function(t){this.to.next(t);var n,e,o=t.get;o&&(n=o["#"])&&((e=a[n]||void 0)&&(o=o["."])&&!Object.plain(o)&&(e=Gun.state.ify({},o,Gun.state.is(e,o),e[o],n)),Gun.on.get.ack(t,e))}),r.on("put",function(t){this.to.next(t);var n=t.put,e=n["#"],o=t["#"],i=t.ok||"";(r.next||"")[e]&&(a[e]=Gun.state.ify(a[e],n["."],n[">"],n[":"],e),c&&4999880<u?r.on("in",{"@":o,err:"localStorage max!"}):(t["@"]||t._.via&&!(Math.random()<i["@"]/i["/"])||f.push(o),s=s||setTimeout(l,9+u/333)))})}function l(){var e;!f.length&&((setTimeout.turn||"").s||"").length?setTimeout(l,99):(e=f,clearTimeout(s),s=!1,f=[],h(a,function(n,t){try{n||i.setItem(o.prefix,t)}catch(t){n=c=t||"localStorage failure"}n&&(Gun.log(n+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),r.on("localStorage:error",{err:n,get:o.prefix,put:a})),u=t.length,setTimeout.each(e,function(t){r.on("in",{"@":t,err:n,ok:0})},0,99)}))}})}})(J,"./localStorage")})(),(()=>{var l,h,n,p,d,s,e,o,i,u,r,a,c,f,g,y,v,t,k,m,b,_,w,$,T,j;function x(t,n){b(this,n)&&void 0!==this[n]||(this[n]=t)}function S(t,n){var e=this.n;if(!e||!(n===e||k(e)&&b(e,n)))return void 0!==n||void 0}function O(t,n){2===arguments.length?(O.r=O.r||{},O.r[t]=n):(O.r=O.r||[],O.r.push(t))}function D(t,n){return!this.id&&n==e&&i(t)?void(this.id=t):this.id=!1}function A(t,n){if(n!==u._)return!s.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}function G(t,n){var e,o=this.o;o.map?void 0===(e=o.map.call(this.as,t,""+n,o.node))?m(o.node,n):o.node&&(o.node[n]=e):s.is(t)&&(o.node[n]=t)}function N(t,n){g!==n&&c.ify(this.o,n,this.s)}function I(t,n){if(!t||n!==u.soul(t)||!u.is(t,this.fn,this.as))return!0;this.cb&&(J.n=t,J.as=this.as,this.cb.call(J.as,t,n,J))}function J(t){t&&u.is(J.n,t,J.as)}function B(t,n){var e;return(e=((t,n)=>{for(var e,o=t.seen,i=o.length;i--;)if(e=o[i],n.obj===e.obj)return e;o.push(n)})(t,n))||(n.env=t,n.soul=W,u.ify(n.obj,E,n)&&(n.link=n.link||s.link.ify(u.soul(n.node)),n.obj!==t.shell)&&(t.graph[s.link.is(n.link)]=n.node),n)}function E(t,n,e){var o,i,r=this,a=r.env;if(u._===n&&b(t,s.link._))return e._;if(o=M(t,n,e,r,a)){if(n||(r.node=r.node||e||{},b(t,u._)&&u.soul(t)&&(r.node._=T(t._)),r.node=u.soul.ify(r.node,s.link.is(r.link)),r.link=r.link||s.link.ify(u.soul(r.node))),(i=a.map)&&(i.call(a.as||{},t,n,e,r),b(e,n))){if(t=e[n],j===t)return void m(e,n);if(!(o=M(t,n,e,r,a)))return}return n?!0===o?t:(i=B(a,{obj:t,path:r.path.concat(n)})).node?i.link:void 0:r.node}}function W(t){var n=this,e=s.link.is(n.link),o=n.env.graph;n.link=n.link||s.link.ify(t),n.link[s.link._]=t,n.node&&n.node[u._]&&(n.node[u._][s.link._]=t),b(o,e)&&(o[t]=o[e],m(o,e))}function M(t,n,e,o,i){var r;return!!s.is(t)||(k(t)?1:(r=i.invalid)?M(t=r.call(i.as||{},t,n,e),n,e,o,i):(i.err="Invalid value at '"+o.path.concat(n).join(".")+"'!",void(h.list.is(t)&&(i.err+=" Use `.set(item)` instead of an Array."))))}function P(t,n){var e,o;if(u._===n)return _(t,s.link._)?void 0:void(this.obj[n]=T(t));(e=s.link.is(t))?(o=this.opt.seen[e])?this.obj[n]=o:this.obj[n]=this.opt.seen[e]=y.to(this.graph,e,this.opt):this.obj[n]=t}""+j!=typeof Gun&&(l=function(t){console.warn("Warning! Deprecated internal utility will break in next version:",t)},(h=Gun).fn=h.fn||{is:function(t){return l("fn"),!!t&&"function"==typeof t}},h.bi=h.bi||{is:function(t){return l("bi"),t instanceof Boolean||"boolean"==typeof t}},h.num=h.num||{is:function(t){return l("num"),!d(t)&&(0<=t-parseFloat(t)+1||1/0===t||-1/0===t)}},h.text=h.text||{is:function(t){return l("text"),"string"==typeof t}},h.text.ify=h.text.ify||function(t){return l("text.ify"),h.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},h.text.random=h.text.random||function(t,n){l("text.random");var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},h.text.match=h.text.match||function(t,n){var e,o;return l("text.match"),"string"==typeof t&&(t===((n=(n="string"==typeof n?{"=":n}:n)||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},h.text.hash=h.text.hash||function(t,n){if(l("text.hash"),"string"==typeof t){if(n=n||0,t.length)for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}},h.list=h.list||{is:function(t){return l("list"),t instanceof Array}},h.list.slit=h.list.slit||Array.prototype.slice,h.list.sort=h.list.sort||function(e){return l("list.sort"),function(t,n){return t&&n?(t=t[e])<(n=n[e])?-1:n<t?1:0:0}},h.list.map=h.list.map||function(t,n,e){return l("list.map"),$(t,n,e)},h.list.index=1,h.obj=h.boj||{is:function(t){return l("obj"),!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},h.obj.put=h.obj.put||function(t,n,e){return l("obj.put"),(t||{})[n]=e,t},h.obj.has=h.obj.has||function(t,n){return l("obj.has"),t&&Object.prototype.hasOwnProperty.call(t,n)},h.obj.del=h.obj.del||function(t,n){if(l("obj.del"),t)return t[n]=null,delete t[n],t},h.obj.as=h.obj.as||function(t,n,e,o){return l("obj.as"),t[n]=t[n]||(o===e?{}:e)},h.obj.ify=h.obj.ify||function(n){if(l("obj.ify"),!k(n))try{n=JSON.parse(n)}catch(t){n={}}return n},h.obj.to=h.obj.to||function(t,n){return l("obj.to"),$(t,x,n=n||{}),n},h.obj.copy=h.obj.copy||function(t){return l("obj.copy"),t&&JSON.parse(JSON.stringify(t))},h.obj.empty=h.obj.empty||function(t,n){return l("obj.empty"),!t||!$(t,S,{n:n})},p=Object.keys,Object.keys=Object.keys||function(t){return n(t,function(t,n,e){e(n)})},h.obj.map=n=h.obj.map||function(t,n,e){l("obj.map");var o,i,r,a,s,u=0,c="function"==typeof n;if(O.r=o,p&&k(t)&&(a=p(t),s=!0),e=e||{},d(t)||a)for(i=(a||t).length;u<i;u++){var f=u+h.list.index;if(c){if((r=s?n.call(e,t[a[u]],a[u],O):n.call(e,t[u],f,O))!==o)return r}else if(n===t[s?a[u]:u])return a?a[u]:f}else for(u in t)if(c){if(b(t,u)&&(r=e?n.call(e,t[u],u,O):n(t[u],u,O))!==o)return r}else if(n===t[u])return u;return c?O.r:h.list.index?0:-1},h.time=h.time||{},h.time.is=h.time.is||function(t){return l("time"),t?t instanceof Date:+(new Date).getTime()},v=h.fn.is,d=h.list.is,k=(t=h.obj).is,b=t.has,$=t.map,(s={is:function(t){return l("val.is"),t!==j&&(null===t||t!==1/0&&(!!(i(t)||o(t)||f(t))||s.link.is(t)))||!1}}).link=s.rel={_:"#"},s.link.is=function(t){if(l("val.link.is"),t&&t[e]&&!t._&&k(t)){var n={};if($(t,D,n),n.id)return n.id}return!1},s.link.ify=function(t){return l("val.link.ify"),w({},e,t)},h.obj.has._=".",e=s.link._,o=h.bi.is,f=h.num.is,i=h.text.is,k=(t=h.obj).is,w=t.put,$=t.map,h.val=h.val||s,(u={_:"_"}).soul=function(t,n){return l("node.soul"),t&&t._&&t._[n||a]},u.soul.ify=function(t,n){return l("node.soul.ify"),n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[a]=n.soul||t._[a]||r(),t},u.soul._=s.link._,u.is=function(t,n,e){var o;return l("node.is"),!!k(t)&&!!(o=u.soul(t))&&!$(t,A,{as:e,cb:n,s:o,n:t})},u.ify=function(t,n,e){return l("node.ify"),n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n={map:n}):n={},n.map&&(n.node=n.map.call(e,t,j,n.node||{})),(n.node=u.soul.ify(n.node||{},n))&&$(t,G,{o:n,as:e}),n.node},k=(t=h.obj).is,m=t.del,$=t.map,r=h.text.random,a=u.soul._,h.node=h.node||u,(c=h.state).lex=function(){return l("state.lex"),c().toString(36).replace(".","")},c.to=function(t,n,e){l("state.to");var o=(t||{})[n];return k(o)&&(o=T(o)),c.ify(e,n,c.is(t,n),o,u.soul(t))},c.map=function(i,r,a){l("state.map");var t=k(t=i||r)?t:null;return i=v(i=i||r)?i:null,t&&!i?(r=f(r)?r:c(),t[g]=t[g]||{},$(t,N,{o:t,s:r}),t):(a=a||k(r)?r:void 0,r=f(r)?r:c(),function(t,n,e,o){if(!i)return N.call({o:e,s:r},t,n),t;i.call(a||this||{},t,n,e,o),b(e,n)&&void 0===e[n]||N.call({o:e,s:r},t,n)})},(t=h.obj).as,b=t.has,k=t.is,$=t.map,T=t.copy,f=h.num.is,v=h.fn.is,g=u._,y={is:function(t,n,e,o){return l("graph.is"),!(!t||!k(t)||_(t)||$(t,I,{cb:n,fn:e,as:o}))},ify:function(t,n,e){l("graph.ify");t={path:[],obj:t};return n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n.map=n):n={},"string"==typeof e&&(n.soul=n.soul||e,e=j),n.soul&&(t.link=s.link.ify(n.soul)),n.shell=(e||{}).shell,n.graph=n.graph||{},n.seen=n.seen||[],n.as=n.as||e,B(n,t),n.root=t.node,n.graph},node:function(t){l("graph.node");var n=u.soul(t);if(n)return w({},n,t)},to:function(t,n,e){if(l("graph.to"),t)return $(t[n],P,{obj:n={},graph:t,opt:e=e||{seen:{}}}),n}},v=h.fn.is,k=(t=h.obj).is,m=t.del,b=t.has,_=t.empty,w=t.put,$=t.map,T=t.copy,h.graph=h.graph||y)})();